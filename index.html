<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ë°”ë³´ ìš©ì‚¬ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        @font-face {
            font-family: 'DungGeunMo';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/DungGeunMo.woff') format('woff');
        }
        :root { --pixel-border: 4px solid #000; }
        body { font-family: 'DungGeunMo', sans-serif; margin: 0; background: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        
        .container { background: #fff; border: var(--pixel-border); padding: 25px; box-shadow: 10px 10px 0 rgba(0,0,0,0.1); width: 1050px; position: relative; }
        
        /* [í•™ìƒìš©] ìºë¦­í„° ì„¹ì…˜ */
        .char-section { 
            width: 250px; display: flex; flex-direction: column; align-items: center; justify-content: center; 
            border-right: 3px dashed #000; padding-right: 20px; min-height: 400px;
        }
        .sword-icon { font-size: 100px; margin-bottom: 15px; line-height: 1; filter: drop-shadow(5px 5px 0px rgba(0,0,0,0.1)); }
        .char-name { background: #ffcc00; border: var(--pixel-border); padding: 8px 20px; font-size: 26px; color: #000; text-align: center; width: 180px; }

        /* [êµì‚¬ìš©] ì§€ì¹¨ ì¤€ìˆ˜ */
        #teacherSection { width: 1550px; } 
        #teacherSection h2 { font-size: 36px; }
        .admin-panel { margin-bottom: 20px; padding: 15px; background: #eee; border: 2px solid #000; font-size: 20px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #fff; border: 2px solid #000; }
        th { background: #333 !important; color: #fff !important; padding: 15px 5px; border: 1px solid #444; font-size: 20px; text-align: center; }
        
        /* ìˆ˜ì¹˜ 2ë°° í™•ëŒ€ (40px) */
        td { padding: 15px 5px; border: 1px solid #000; text-align: center; font-size: 40px; color: #000; line-height: 1.2; }
        td.st-info { font-size: 22px; } 

        .bg-s { background: #eef7ff; } .bg-r { background: #fff9db; } .bg-p { background: #ebfbee; }
        .bold { font-weight: bold; }
        
        /* íŠ¹ë³„í¬ì¸íŠ¸ ì…ë ¥ì¹¸ */
        .extra-input { 
            width: 100px; padding: 5px; font-family: 'DungGeunMo'; border: 4px solid #333; 
            text-align: center; font-size: 40px; background: #fff176; 
        }

        /* í•™ìƒìš© ìŠ¤íƒ¯ ë ˆì´ì•„ì›ƒ ë° ìŠ¬ë¼ì´ë” ì •ë°€ ì¡°ì • */
        .student-layout { display: flex; gap: 30px; align-items: stretch; }
        .stat-section { flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .point-info { background: #ffeb3b; border: var(--pixel-border); padding: 10px; text-align: center; margin-bottom: 20px; font-size: 20px; font-weight: bold; }
        .stat-row { margin-bottom: 18px; }
        .stat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 20px; }
        .ability-badge { border: 2px solid #000; padding: 4px 12px; background: #fff; font-size: 16px; }
        
        /* ìŠ¬ë¼ì´ë” ë°” ì»¨í…Œì´ë„ˆ: ëë¶€ë¶„ ì¼ì¹˜ë¥¼ ìœ„í•´ overflow hidden ë° padding ì œê±° */
        .bar-container { height: 32px; background: #eee; border: 3px solid #000; position: relative; overflow: visible; padding: 0; margin: 0; }
        .bar-fill { height: 100%; transition: width 0.1s; width: 0%; }
        
        /* ìŠ¬ë¼ì´ë” ì¸í’‹: ë°”ì˜ ì¢Œìš° ëê³¼ ì™„ë²½íˆ ì¼ì¹˜í•˜ë„ë¡ ì„¤ì • */
        .slider { 
            position: absolute; top: -3px; left: -2px; width: calc(100% + 4px); height: calc(100% + 6px); 
            -webkit-appearance: none; background: transparent; z-index: 10; cursor: pointer; margin: 0; padding: 0;
        }
        .slider:focus { outline: none; }
        /* ìŠ¬ë¼ì´ë” í•¸ë“¤(Thumb) */
        .slider::-webkit-slider-thumb { 
            -webkit-appearance: none; width: 12px; height: 42px; background: #000; 
            border: 1px solid #fff; cursor: pointer; 
        }
        .slider::-moz-range-thumb { 
            width: 12px; height: 42px; background: #000; border: 1px solid #fff; cursor: pointer; 
        }
        
        button { font-family: 'DungGeunMo'; padding: 12px 24px; border: var(--pixel-border); cursor: pointer; background: #aed581; font-size: 20px; }
        #loginSection { position: fixed; z-index: 100; background: white; padding: 40px; border: var(--pixel-border); text-align: center; }
    </style>
</head>
<body>

    <div id="loginSection">
        <h2>âš”ï¸ ìš©ì‚¬ ì‹œìŠ¤í…œ ì ‘ì†</h2>
        <input type="text" id="loginCode" placeholder="ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="padding:10px; font-family:'DungGeunMo'; border:3px solid #000; width:220px; font-size:18px;"><br><br>
        <button onclick="login()">ì…ì¥í•˜ê¸°</button>
    </div>

    <div class="container" id="studentSection" style="display:none;">
        <div class="student-layout">
            <div class="char-section">
                <div class="sword-icon">âš”ï¸</div>
                <div class="char-name" id="stNameDisplay">ìš©ì‚¬</div>
            </div>
            <div class="stat-section">
                <div id="pointInfo" class="point-info">í¬ì¸íŠ¸ ê³„ì‚° ì¤‘...</div>
                <div class="stat-row">
                    <div class="stat-header"><span>âœŒï¸ ê°€ìœ„: <b id="val_s">0</b></span> <span class="ability-badge" id="badge_s" style="color:blue;">ê³µê²©ë ¥ +2</span></div>
                    <div class="bar-container"><div class="bar-fill" id="fill_s" style="background:#4da6ff;"></div><input type="range" id="in_s" class="slider" min="0" max="20" value="0" oninput="updateUI()"></div>
                </div>
                <div class="stat-row">
                    <div class="stat-header"><span>âœŠ ë°”ìœ„: <b id="val_r">0</b></span> <span class="ability-badge" id="badge_r" style="color:orange;">íšŒë³µë ¥ +0</span></div>
                    <div class="bar-container"><div class="bar-fill" id="fill_r" style="background:#ffa500;"></div><input type="range" id="in_r" class="slider" min="0" max="20" value="0" oninput="updateUI()"></div>
                </div>
                <div class="stat-row">
                    <div class="stat-header"><span>ğŸ–ï¸ ë³´: <b id="val_p">0</b></span> <span class="ability-badge" id="badge_p" style="color:green;">í”¼í•´ê°ì†Œ -0</span></div>
                    <div class="bar-container"><div class="bar-fill" id="fill_p" style="background:#4caf50;"></div><input type="range" id="in_p" class="slider" min="0" max="20" value="0" oninput="updateUI()"></div>
                </div>
                <div class="stat-row">
                    <div class="stat-header"><span>â¤ï¸ ì²´ë ¥: <b id="val_h">1</b></span></div>
                    <div class="bar-container"><div class="bar-fill" id="fill_h" style="background:#e63946;"></div><input type="range" id="in_h" class="slider" min="1" max="20" value="1" oninput="updateUI()"></div>
                </div>
                <div id="sumBar" style="padding:15px; border:3px solid #000; text-align:center; font-weight:bold; margin-top:10px; font-size:20px;">í•©ê³„ í™•ì¸ ì¤‘...</div>
                <div style="display:flex; gap:10px; margin-top:20px;">
                    <button onclick="saveStats()" style="flex:2;">ìŠ¤íƒ¯ í™•ì • ë° ì €ì¥</button>
                    <button onclick="location.reload()" style="flex:1; background:#eee; color:#000;">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container" id="teacherSection" style="display:none;">
        <h2>ğŸ“‹ ìš©ì‚¬ ê´€ë¦¬ì ëª¨ë“œ</h2>
        <div class="admin-panel">
            <strong>âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì •</strong><br>
            ì•±í‚¤: <input type="text" id="configApiKey" style="width:450px; padding:5px; font-family:'DungGeunMo';">
            <button onclick="saveConfig()" style="background:#ddd; padding:5px 15px;">ì„¤ì • ì €ì¥</button>
            <hr style="border:1px dashed #aaa; margin:15px 0;">
            <strong>ğŸ‘¥ í•™ìƒ ì¼ê´„ ë“±ë¡</strong><br>
            <textarea id="bulkInput" style="width:100%; height:80px; margin-top:10px; font-family:'DungGeunMo'; font-size:18px;" placeholder="ì´ë¦„ê³¼ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: í™ê¸¸ë™ 1001)"></textarea>
            <button id="regBtn" onclick="bulkRegister()" style="background:#4da6ff; color:white; width:100%; margin-top:10px;">í•™ìƒ ëª©ë¡ ë“±ë¡ ë° ì¡°íšŒ</button>
        </div>
        <table>
            <thead>
                <tr>
                    <th>í•™ìƒëª…(ì½”ë“œ)</th>
                    <th>ë ˆë²¨</th>
                    <th>íŠ¹ë³„í¬ì¸íŠ¸</th>
                    <th>âœŒï¸ê°€ìœ„</th>
                    <th>âš”ï¸ê³µê²©</th>
                    <th>âœŠë°”ìœ„</th>
                    <th>âœ¨íšŒë³µ</th>
                    <th>ğŸ–ï¸ë³´</th>
                    <th>ğŸ›¡ï¸ë°©ì–´</th>
                    <th>â¤ï¸ì²´ë ¥</th>
                    <th style="background:#d32f2f !important;">ì ê²€</th>
                </tr>
            </thead>
            <tbody id="teacherTableBody"></tbody>
        </table>
        <button onclick="location.reload()" style="margin-top:20px; width:100%; background:#000; color:#fff;">ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <script>
        let API_KEY = localStorage.getItem('v_api_key') || "dd76342663eba41ce22a80451c96f26e028750feac6f00a0";
        const BASE_URL = "https://api.dahandin.com/openapi/v1/get/student/total";
        let currentUser = null;
        let targetTotal = 0;

        async function login() {
            const code = document.getElementById('loginCode').value.trim();
            if(!code) return alert("ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
            if(code === "csgo10") { showTeacher(); return; }
            const userKey = `v_user_${code}`;
            const studentInfo = JSON.parse(localStorage.getItem(userKey));
            if(!studentInfo) return alert("ë“±ë¡ë˜ì§€ ì•Šì€ ì½”ë“œì…ë‹ˆë‹¤.");
            try {
                const response = await fetch(`${BASE_URL}?code=${code}`, { headers: { "X-API-Key": API_KEY } });
                const result = await response.json();
                const data = result.data || result;
                const indExtra = parseInt(studentInfo.extra) || 0;
                currentUser = { code, name: data.name || studentInfo.name, cookie: data.cookie || 0, extra: indExtra };
                const lvPoint = Math.floor((Number(currentUser.cookie) || 0) / 10);
                targetTotal = lvPoint + indExtra;
                document.getElementById('stNameDisplay').innerText = currentUser.name;
                document.getElementById('pointInfo').innerText = `ê°€ìš© í¬ì¸íŠ¸: ${targetTotal} (Lv.${lvPoint} + íŠ¹ë³„ ${indExtra})`;
                const saved = JSON.parse(localStorage.getItem(`v_stat_${code}`));
                if(saved) {
                    document.getElementById('in_s').value = saved.s;
                    document.getElementById('in_r').value = saved.r;
                    document.getElementById('in_p').value = saved.p;
                    document.getElementById('in_h').value = saved.h;
                }
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('studentSection').style.display = 'block';
                updateUI();
            } catch(e) { alert("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨!"); }
        }

        function updateUI() {
            const s = parseInt(document.getElementById('in_s').value), r = parseInt(document.getElementById('in_r').value), p = parseInt(document.getElementById('in_p').value), h = parseInt(document.getElementById('in_h').value);
            ['s','r','p','h'].forEach(id => {
                const val = eval(id);
                document.getElementById('val_'+id).innerText = val;
                // ë°” ì±„ìš°ê¸° ê³„ì‚° (ìµœëŒ€ 20 ê¸°ì¤€)
                document.getElementById('fill_'+id).style.width = (val / 20 * 100) + '%';
            });
            const atk = s >= 20 ? 4 : (s >= 10 ? 3 : 2), rec = r >= 20 ? 2 : (r >= 10 ? 1 : 0), def = p >= 20 ? 2 : (p >= 10 ? 1 : 0);
            document.getElementById('badge_s').innerText = `ê³µê²©ë ¥ +${atk}`;
            document.getElementById('badge_r').innerText = `íšŒë³µë ¥ +${rec}`;
            document.getElementById('badge_p').innerText = `í”¼í•´ê°ì†Œ -${def}`;
            const sum = s + r + p + h;
            const bar = document.getElementById('sumBar');
            bar.innerText = `í˜„ì¬ í•©ê³„: ${sum} / ëª©í‘œ: ${targetTotal}`;
            bar.style.backgroundColor = (sum === targetTotal) ? "#d4edda" : "#f8d7da";
        }

        function saveStats() {
            const s = parseInt(document.getElementById('in_s').value), r = parseInt(document.getElementById('in_r').value), p = parseInt(document.getElementById('in_p').value), h = parseInt(document.getElementById('in_h').value);
            if(s+r+p+h !== targetTotal) return alert("ëª©í‘œ í¬ì¸íŠ¸ì™€ í•©ê³„ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤!");
            localStorage.setItem(`v_stat_${currentUser.code}`, JSON.stringify({ name: currentUser.name, s, r, p, h, lv: Math.floor(currentUser.cookie/10), extra: currentUser.extra }));
            alert("ì €ì¥ ì™„ë£Œ!");
        }

        function showTeacher() { document.getElementById('loginSection').style.display = 'none'; document.getElementById('teacherSection').style.display = 'block'; document.getElementById('configApiKey').value = API_KEY; loadAdminTable(); }
        function saveConfig() { localStorage.setItem('v_api_key', document.getElementById('configApiKey').value); alert("ì•±í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."); location.reload(); }
        function autoSaveExtra(code, val) { const userKey = `v_user_${code}`; const userData = JSON.parse(localStorage.getItem(userKey)); if(userData) { userData.extra = parseInt(val) || 0; localStorage.setItem(userKey, JSON.stringify(userData)); loadAdminTable(); } }

        async function bulkRegister() {
            const input = document.getElementById('bulkInput').value.trim(); if(!input) return;
            const btn = document.getElementById('regBtn'); btn.innerText = "ì¡°íšŒ ì¤‘..."; btn.disabled = true;
            const lines = input.split(/[\s\n,]+/);
            for(let i=0; i<lines.length; i+=2) {
                const name = lines[i], code = lines[i+1];
                if(name && code) {
                    try {
                        const res = await fetch(`${BASE_URL}?code=${code}`, { headers: { "X-API-Key": API_KEY } });
                        const data = (await res.json()).data || {};
                        const existing = JSON.parse(localStorage.getItem(`v_user_${code}`)) || { extra: 0 };
                        localStorage.setItem(`v_user_${code}`, JSON.stringify({ name: data.name || name, cookie: data.cookie || 0, extra: existing.extra }));
                    } catch(e) { localStorage.setItem(`v_user_${code}`, JSON.stringify({ name: name, cookie: 0, extra: 0 })); }
                }
            }
            btn.innerText = "í•™ìƒ ëª©ë¡ ë“±ë¡ ë° ì¡°íšŒ"; btn.disabled = false; loadAdminTable();
        }

        function loadAdminTable() {
            const body = document.getElementById('teacherTableBody'); body.innerHTML = "";
            let keys = []; for(let i=0; i<localStorage.length; i++) if(localStorage.key(i).startsWith('v_user_')) keys.push(localStorage.key(i));
            keys.sort().forEach(key => {
                const code = key.replace('v_user_', ''), user = JSON.parse(localStorage.getItem(key)), stat = JSON.parse(localStorage.getItem(`v_stat_${code}`)) || {s:0, r:0, p:0, h:1};
                const currentLv = Math.floor((user.cookie || 0) / 10);
                const extra = parseInt(user.extra) || 0;
                const atk = stat.s >= 20 ? 4 : (stat.s >= 10 ? 3 : 2), rec = stat.r >= 20 ? 2 : (stat.r >= 10 ? 1 : 0), def = stat.p >= 20 ? 2 : (stat.p >= 10 ? 1 : 0);
                const goal = currentLv + extra;
                const currentSum = stat.s + stat.r + stat.p + stat.h;
                const checkMark = (goal === currentSum) ? "<span style='color:green;'>â—‹</span>" : "<span style='color:red;'>Ã—</span>";
                body.innerHTML += `<tr><td class="st-info bold">${user.name}<br>(${code})</td><td class="bold">${currentLv}</td><td><input type="number" class="extra-input" value="${extra}" onchange="autoSaveExtra('${code}', this.value)"></td><td class="bg-s">${stat.s}</td><td class="bg-s bold" style="color:blue">+${atk}</td><td class="bg-r">${stat.r}</td><td class="bg-r bold" style="color:orange">+${rec}</td><td class="bg-p">${stat.p}</td><td class="bg-p bold" style="color:green">-${def}</td><td class="bold">${stat.h}</td><td class="bold">${checkMark}</td></tr>`;
            });
        }
    </script>
</body>
</html>